# Dev Deck 页面与功能需求说明书

版本：v1.0  
日期：2025-10-17

## 1. 项目概览
Dev Deck 是一个本地开发项目管理与启动工具，提供对多个项目（任务）的统一查看、筛选、分组、排序与运行控制。系统以仪表盘（Dashboard）为核心页面，结合项目卡片（ProjectCard）与表单（ProjectForm）实现项目的创建、编辑、启动、停止、重启与删除等操作。

## 2. 术语与定义
- 项目（Project/任务）：一个可启动的本地服务或脚本，包含启动命令、工作目录等信息。
- 任务组（Group）：项目的分组标签，用于对项目进行逻辑聚合与筛选；支持“未分组”。
- 守护进程（Auto Restart）：任务运行监控与自动重启能力的开关。
- 运行状态：running（运行中）、stopped（已停止）、executing（启动中）、error（错误）。

## 3. 页面与功能
### 3.1 仪表盘（Dashboard）
仪表盘用于查看与管理所有项目，并支持搜索、筛选、分组、排序、视图切换与基本操作。

#### 3.1.1 过滤栏（Filter Bar）
- 搜索框：按项目名称或描述关键字过滤。
- 分类筛选（Select）：按项目类别（前端/后端/数据库/微服务/移动端/桌面应用/脚本/其他）过滤。
- 状态筛选（Select）：按运行状态过滤（运行中/已停止/执行中/错误）。
- 视图切换按钮：
  - 网格视图与列表视图图标按钮，支持鼠标与键盘操作（title/aria-label）。
- 分组开关（Layers 图标按钮）：
  - 切换“按任务组展示”和“取消分组展示”。
  - 分组开关的状态变化应立即更新列表展示。
- 排序（Select）：置于图标区域的左侧。支持按名称、类别、状态、组等排序。

#### 3.1.2 分组与未分组
- Radix UI 的 Select 不允许空字符串作为 SelectItem 的 value；系统对“未分组”使用哨兵值 `__none__` 表示，并在 onValueChange 中映射回空字符串以保持数据结构。
- 列表渲染时对旧数据进行硬化处理：仅包含非空组名参与排序与分组，避免异常。

#### 3.1.3 项目卡片（ProjectCard）
每个项目以卡片形式展示，包含以下信息与操作：
- 标题区：
  - 项目名称（加粗，截断显示）、描述（两行截断）、分类徽章（中文标签与配色）。
  - 状态指示：圆点颜色随状态变化，running/executing 状态下圆点脉冲动效。
- 信息栅格：
  - 工作目录（Folder 图标 + 路径，截断显示）。
  - 端口（Terminal 图标 + 端口号）。
  - 定时启动（Clock 图标 + 时间）。
  - 守护进程（Shield 图标 + 文本）：
    - 开启（text-green-600，标题提示“守护进程已开启”）。
    - 未开启（text-gray-400，标题提示“守护进程未开启”）。
  - 任务组（Layers 图标 + 文本）：显示“任务组: {group || 未分组}”。
  - 开始时间（Clock 图标 + 格式化时间 YYYY-MM-DD HH:mm:ss），当有 last_started 时显示。
  - 已运行时长（Timer 图标 + HH:MM:SS）：当 status 为 running 或 executing 且有 last_started 时显示；每秒更新。
- 命令预览：
  - 深色代码块展示启动命令（单行截断）。
- 操作按钮：
  - 启动（Play，绿色实心按钮）。
  - 停止（Square，红色 destructive 按钮，显示“停止”文案）。
  - 重启（RotateCw，outline 按钮）。
  - 设置（Settings，outline 图标按钮）。
  - 删除（Trash，outline 图标按钮，点击弹出 AlertDialog 确认框）：
    - 标题：确认删除
    - 描述：将删除项目「{name}」，此操作不可撤销。
    - 操作：取消 / 删除（红色实心）

#### 3.1.4 交互与无障碍
- 所有图标按钮提供可读 title 与 aria-label，支持键盘焦点与激活。
- 守护进程的开关状态仅在卡片展示，不在过滤栏控制。
- 删除确认统一使用 AlertDialog，避免原生 confirm 的不一致样式。

### 3.2 项目创建与编辑（ProjectForm）
用于创建与编辑项目的表单，要求：
- 字段：
  - 名称、描述、类别、任务组（选择已有组或输入新组）、工作目录、启动命令、端口、定时启动、守护进程开关。
- 分组选择：
  - “未分组”使用哨兵值 `__none__`，提交时映射为空字符串存储。
- 验证与纠正：
  - 数字字段支持清空与纠正（例如端口）。
  - 必填项校验与错误提示。
- 保存交互：
  - 保存成功与失败的 toast 提示。

### 3.3 数据与 API
- localProjects.js：
  - listProjects：返回项目列表。
  - createProject：创建新项目并保存。
  - updateProject：根据 id 更新项目并保存。
  - deleteProject：根据 id 删除项目并保存。
  - 数据模型字段（示例）：
    - id, name, description, category, group, working_directory, start_command, port, scheduled_start, auto_restart, status, last_started。
- processControl.js：
  - start/stop/restart：对本地进程执行相关控制（用于按钮动作）。
- Dashboard.jsx：
  - 通过 React Query 获取列表与执行删除等 mutation，操作后刷新列表并提示。

## 4. 设计规范
- 组件：采用 shadcn/ui（Card、Badge、Button、AlertDialog、Select 等）。
- 图标：lucide-react（Play, Square, RotateCw, Settings, Terminal, Folder, Clock, Shield, Loader2, Trash, Timer, Layers）。
- 样式：Tailwind CSS；按钮风格遵循：启动为绿色实心，停止为红色 destructive，重启/设置/删除为 outline 图标按钮。
- 布局：卡片最小高度 min-h-[280px]，自适应增长；信息栅格与操作区分层清晰；命令预览为深色代码块。
- 文案：中文标签与提示，“未分组”作为缺省分组名称。

## 5. 可用性与可访问性（A11y）
- 图标按钮均提供 title 与 aria-label。
- 颜色语义清晰：绿色为运行/开启，红色为停止/删除，灰色为禁用/未开启。
- 分组切换与排序位置符合习惯：排序在图标左侧，图标区域包含视图切换与分组开关。

## 6. 非功能需求
- 性能：使用 React Query 缓存与轻量渲染；避免排序/分组对空数据导致异常。
- 可靠性：对旧数据进行容错；Select 组件使用哨兵值规避空字符串限制。
- 可维护性：代码模块化（pages/components/api/hooks/ui），命名清晰。
- 兼容性：浏览器端运行（Vite），Radix UI 组件限制已知并处理。

## 7. 测试与验收标准
- 创建/编辑表单：
  - 选择“未分组”时保存成功，组字段为空字符串存储。
  - 输入新组名称并保存，列表正确展示在对应分组。
  - 清空端口等数字输入不导致崩溃或异常。
- 过滤栏：
  - 搜索、分类、状态筛选联动正确。
  - 分组开关（图标）切换后，列表分组展示与未分组展示切换正确。
  - 排序下拉位于图标左侧，排序结果正确。
- 项目卡片：
  - 运行状态显示正确，执行中显示 Loader 动画。
  - 守护进程信息始终显示：开启为绿色，未开启为灰色。
  - 显示开始时间（格式正确）与已运行时长（秒级刷新）。
  - 删除按钮为 outline 图标；点击弹出 AlertDialog，确认后删除成功刷新列表并提示。
  - 停止/重启/设置按钮行为正确，状态与 UI 同步。
- 视图切换：
  - 网格/列表视图切换正常，键盘可访问。

## 8. 未来优化建议
- 偏好持久化：视图模式、分组开关、排序选项持久化到本地存储。
- 删除安全策略：对运行中项目删除时提示先停止或支持“先停后删”。
- 移动端优化：针对窄屏收纳过滤栏与按钮布局。
- 国际化：多语言支持（中/英）。
- 性能提升：长列表虚拟化、代码拆分、图标与样式按需加载。

---
本说明书基于当前代码结构与已实现交互行为撰写，后续变更请同步更新本文件以保持需求与实现一致。